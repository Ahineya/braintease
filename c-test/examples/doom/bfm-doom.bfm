#include "titlepic-loader.bfm"
#include "palette-loader.bfm"

@proc(main, 
  @call(iwad)
  @call(load_titlepic)
  @call(load_palette)

  // So now our palette is loaded, and the titlepic is in memory.
  // Now we need to replace values in the titlepic with the palette values.

  @set(s0, 0) // i
  @set(s1, 63999)
  @set(s3, #TITLEPIC_MEMORY_BANK)

  @while(@ne(s0, s1),
    @set(t0, #PALETTE_MEMORY_BANK)
    @peek(s2, s3, s0) // Now s2 contains the pixel value
    @peek(s2, t0, s2) // Get the RGB565 value from the palette
    @poke(s2, s3, s0) // Write the RGB
    @inc(s0)
  )
)
